 <!DOCTYPE html>
<html>

 <head>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round|Open+Sans">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="./app/css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="table.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head> 

<body>

<div class="container">
        <div class="table-wrapper">
            <div class="table-title">
                <div class="row">
                    <div class="col-sm-8"><h2>Account <b>Details</b></h2></div>
                    <div class="col-sm-4">
                        <button type="button" class="btn btn-info add-new"><i class="fa fa-plus"></i> Add New</button>
                    </div>
                </div>
            </div>
            <table class="table table-bordered">
                <thead>
                    <tr >
                        <th>No</th>
                        <th>Account Id</th>
                        <th>Account Name</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="t1001">
                        <td>1</td>
                        <td>10001</td>
                        <td>Logss</td>
                        <td>
              <a class="add" title="Add" data-toggle="tooltip"><i class="material-icons">&#xE03B;</i></a>
                            <a class="edit" title="Edit" data-toggle="tooltip"><i class="material-icons">&#xE254;</i></a>
                            <a class="delete" title="Delete" data-toggle="tooltip"><i class="material-icons">&#xE872;</i></a>
                        </td>
                    </tr>     
                </tbody>
            </table>
        </div>
    </div>  

<?php
session_start();
echo "tt";

if( !isset($_SESSION["user_name"]) ){
      header("location:login.html");
}
else {
    if($_SESSION['user_role'] != 1){
        header("location:index.php");
    }
}

?>

<script type="text/javascript">

var sql_state = 0;


$(document).ready(function(){
  $('[data-toggle="tooltip"]').tooltip();
  var actions = $("table td:last-child").html();
  // Append table with add row form on add new button click
    $(".add-new").click(function(){
    $(this).attr("disabled", "disabled");
    var index = $("table tbody tr:last-child").index();
    var id_tr =  $("table tbody tr:last-child").attr("id");
    console.log(id_tr);
    var id_number = id_tr.substring(1 , id_tr.length);
    id_number ++;
    id_tr  = "t" + id_number  ;
    var index_new = index + 2;
        var row = `<tr id=${id_tr}>
            <td><input type='text' class='form-control' name='name' id='name' value=${index_new}></td>
            <td><input type="text" class='form-control' name='department' id='department' value=${id_number}></td>
            <td><input type="text" class='form-control' name='phone' id='phone'></td>
            <td>${actions}</td> 
            </tr>`;
      $("table").append(row);   
    $("table tbody tr").eq(index + 1).find(".add, .edit").toggle();
        $('[data-toggle="tooltip"]').tooltip();
        sql_state = 1;
    });


  // Add row on add button click
  $(document).on("click", ".add", function(){
    var empty = false;
    var input = $(this).parents("tr").find('input[type="text"]');
    
    console.log(input);
        input.each(function(){
      if(!$(this).val()){
        $(this).addClass("error");
        empty = true;
      } else{
                $(this).removeClass("error");
            }
    });
    $(this).parents("tr").find(".error").first().focus();
    if(!empty){
      var input_list = [];
      console.log("add data");
      input.each(function(){
        input_list.push($(this).val());
      });     

      if(sql_state == 1)
      {
          //insert 
          var send_data = {
            id : input_list[1],
            name : input_list[2]
          };

          console.log(send_data);

          $.ajax({
          url: './app/action/add_account.php',
          type: 'post', //หรือ post (ค่าเริ่มต้นเป็นแบบ get)
          data: send_data,
          dataType: 'json', //หรือ json หรือ xml
          success: function(response){
              input.each(function(){
                $(this).parent("td").html($(this).val());
            });            
          console.log("add success " );
          }
        });

      }
      else if(sql_state == 2)
      {
          //update
      }

      $(this).parents("tr").find(".add, .edit").toggle();
      $(".add-new").removeAttr("disabled"); 
    }   
    });


  // Edit row on edit button click
  $(document).on("click", ".edit", function(){    
        $(this).parents("tr").find("td:not(:last-child)").each(function(){
      $(this).html('<input type="text" class="form-control" value="' + $(this).text() + '">');
    });   
    $(this).parents("tr").find(".add, .edit").toggle();
    $(".add-new").attr("disabled", "disabled"); // disible add btn
    sql_state = 2;
    var id_update = $(this).parents("tr").attr("id");
    console.log("id update" + id_update);
    });

  // Delete row on delete button click
  $(document).on("click", ".delete", function(){
        $(this).parents("tr").remove();
    $(".add-new").removeAttr("disabled");  // disible add btn
    });
});
</script>

</body>
</html> 